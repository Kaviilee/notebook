{"version":1582593954133,"name":"data","data":[{"column":[{"title":"Sequelize","barcolor":"","fold":false,"box":[{"title":"Connect","fold":false,"list":[{"prefix":"","tag":"new Sequelize","suffix":"(config)","desc":"创建数据库连接实例\n`const sequelize = new Sequelize(\"sqlite::memory:\");`","url":"","summary":"```javascript\nconst sequelize = new Sequelize(database, username, password, {\n    host: host,\n    dialect: \"mysql\",\n    pool: {\n        max: 5,\n        min: 0,\n        idle: 30000,\n        acquire: 20000,\n    },\n    logging: true,\n    timezone: \"+08:00\",\n    define: {\n        timestamps: true,\n        createdAt: true,\n        updatedAt: true,\n        underscored: true\n    },\n    query: {\n        raw: true,\n    },\n});\n\nsequelize\n    .authenticate()\n    .then(() => {\n        console.log(\"Connection has been established successfully.\");\n    })\n    .catch(err => {\n        console.error(\"Unable to connect to the database:\", err);\n    });\n\n// 一次性同步全部模型\n// sequelize.sync();\n```","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/getting-started.md","dot":""},{"prefix":"sequelize","tag":".sync()","suffix":"","desc":"一次性同步全部模型","url":"","summary":"","reference":"","dot":""}]},{"title":"Model","fold":false,"list":[{"prefix":"","tag":"$Model","suffix":".init({})","desc":"初始化 模型类\n```\nclass User extends Model {}\nUser.init({\n  // 在这里定义模型属性\n  key: {\n    type: DataTypes.STRING,\n    ..\n  },\n}, {\n  // 这是其他模型参数\n  sequelize, // 我们需要传递连接实例\n  modelName: 'User' // 我们需要选择模型名称\n  tableName : \"tablename\", //表名\n});\n```","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-basics.md","dot":""},{"prefix":"$Model","tag":".sync()","suffix":"","desc":"同步模型，仅读实例时可无","url":"","summary":"```\nconst { Sequelize, DataTypes, Model } = require('sequelize');\nconst sequelize = new Sequelize('sqlite::memory');\n\nclass User extends Model {}\nUser.init({\n  // 在这里定义模型属性\n  col: {\n    type: DataTypes.STRING,\n    allowNull: false\n  },\n}, {\n  // 这是其他模型参数\n  sequelize, // 我们需要传递连接实例\n  modelName: 'User' // 我们需要选择模型名称\n  tableName : \"tablename\", //表名\n  createdAt: \"user_registered\", //timestamp列名重定义\n});\n\n//同步模型，仅读实例时可无\nUser.sync()\n```","reference":"","dot":""},{"prefix":"","tag":"DataTypes","suffix":".TYPE","desc":"# 数据类型\n+ `STRING` 字符串\n+ `TEXT` 长文\n+ `INTEGER` 整数  \n+ `BIGINT(11)` 大整数\n+ `DATE` 日期时间","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-basics.md","dot":""},{"prefix":"","tag":"key","suffix":".$prop","desc":"# 列参数\n+ `type`: DataTypes.BOOLEAN 数据类型\n+ `primaryKey`: true 主键\n+ `autoIncrement`: true 自增\n+ `allowNull`: false 非空\n+ `defaultValue`: DataTypes.NOW 默认值\n+ `unique`: true 唯一\n+ unique: 'group' 组合唯一\nuniqueOne: { type: DataTypes.STRING,  unique: 'compositeIndex' },\nuniqueTwo: { type: DataTypes.INTEGER, unique: 'compositeIndex' },\n","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-basics.md","dot":""},{"prefix":"key.","tag":"get|set()","suffix":"","desc":"+ getter `get(){this.getDataValue('col')}`\n+ setter `set(val){this.setDataValue('col', hash(val))}`\n+ 虚拟列 `DataTypes.VIRTUAL`","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/getters-setters-virtuals.md","dot":""},{"prefix":"key.","tag":"validate","suffix":"","desc":"验证\n```\nkey: {\n    type: DataTypes.STRING,\n    validate : {\n        is: /^[a-z]+$/i,          // 匹配这个 RegExp\n        isInt: {\n            msg: \"必须是价格的整数\"\n        },\n        isIn: {\n            args: [['en', 'zh']],\n            msg: \"必须为英文或中文\"\n        },\n        isEven(value) {  //自定义规则\n            if (parseInt(value) % 2 !== 0) {\n                throw new Error('Only even values are allowed!');\n            }\n        }\n    }\n}\n```","url":"","summary":"is: /^[a-z]+$/i,          // 匹配这个 RegExp\nis: [\"^[a-z]+$\",'i'],     // 与上面相同,但是以字符串构造 RegExp\nnot: /^[a-z]+$/i,         // 不匹配 RegExp\nnot: [\"^[a-z]+$\",'i'],    // 与上面相同,但是以字符串构造 RegExp\nisEmail: true,            // 检查 email 格式 (foo@bar.com)\nisUrl: true,              // 检查 url 格式 (http://foo.com)\nisIP: true,               // 检查 IPv4 (129.89.23.1) 或 IPv6 格式\nisIPv4: true,             // 检查 IPv4 格式 (129.89.23.1)\nisIPv6: true,             // 检查 IPv6 格式\nisAlpha: true,            // 只允许字母\nisAlphanumeric: true,     // 将仅允许使用字母数字,因此 '_abc' 将失败\nisNumeric: true,          // 只允许数字\nisInt: true,              // 检查有效的整数\nisFloat: true,            // 检查有效的浮点数\nisDecimal: true,          // 检查任何数字\nisLowercase: true,        // 检查小写\nisUppercase: true,        // 检查大写\nnotNull: true,            // 不允许为空\nisNull: true,             // 只允许为空\nnotEmpty: true,           // 不允许空字符串\nequals: 'specific value', // 仅允许 'specific value'\ncontains: 'foo',          // 强制特定子字符串\nnotIn: [['foo', 'bar']],  // 检查值不是这些之一\nisIn: [['foo', 'bar']],   // 检查值是其中之一\nnotContains: 'bar',       // 不允许特定的子字符串\nlen: [2,10],              // 仅允许长度在2到10之间的值\nisUUID: 4,                // 只允许 uuid\nisDate: true,             // 只允许日期字符串\nisAfter: \"2011-11-05\",    // 仅允许特定日期之后的日期字符串\nisBefore: \"2011-11-05\",   // 仅允许特定日期之前的日期字符串\nmax: 23,                  // 仅允许值 <= 23\nmin: 23,                  // 仅允许值 >= 23\nisCreditCard: true,       // 检查有效的信用卡号","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/validations-and-constraints.md","dot":""}]},{"title":"Create","fold":false,"list":[{"prefix":"$Model","tag":".create","suffix":"(obj)","desc":"添加实例 `const record = await User.create({ name: \"Jane\" });`\n","url":"","summary":"# 查看实例条目尽量使用过滤\n`$model_ins.toJSON()`\n\n# 同步手动方法\n```\nconst jane = User.build({ name: \"Jane\" });\n//do some edit\nawait jane.save();\n```","reference":"","dot":""},{"prefix":"$Model","tag":".bulkCreate","suffix":"([obj,..])","desc":"批量创建\nfields 参数指定批量创建时使用的字段，其余字段将被忽略.\n```\nawait User.bulkCreate([\n  { username: 'foo' },\n  { username: 'bar', admin: true }\n], { fields: ['username'] });\n// foo 和 bar 都不会是管理员.\n```","url":"","summary":"","reference":"","dot":""}]},{"title":"Delete","fold":false,"list":[{"prefix":"record","tag":".destroy()","suffix":"","desc":"删除实例 `await jane.destroy();`","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".destroy","suffix":"(opt)","desc":"```\n// 删除所有名为 \"Jane\" 的人 \nawait User.destroy({\n  where: {\n    firstName: \"Jane\"\n  }\n});\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".restore","suffix":"(opt)","desc":"# 模型设置\n`paranoid: true`\n# 删除操作\n软删除 `await $Model.destroy(opt)`\n硬删除 `await $Model.destroy({opt,force: true})`\n# 恢复\n`await $Model.restore(opt)`\n# 查询\n`await $Model.findAll({opt,paranoid: false})`","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/paranoid.md","dot":""}]},{"title":"Update","fold":false,"list":[{"prefix":"record","tag":".reload()","suffix":"","desc":"重载实例 `await jane.reload();`","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-instances.md","dot":""},{"prefix":"record","tag":".increment","suffix":"(key)","desc":"递减 `decrement` \n递增1 `await user.increment('age')`\n递增2 `await user.increment('age', { by: 2 })`\n多个列递增\n```\nawait jane.increment({\n  'age': 2,\n  'cash': 100\n});\n```\n多个列相同递增 `await jane.increment(['age', 'cash'], { by: 2 });`","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-instances.md","dot":""},{"prefix":"$Model","tag":".update","suffix":"(keys,opt)","desc":"```\n// 将所有没有姓氏的人更改为 \"Doe\"\nawait User.update({ lastName: \"Doe\" }, {\n  where: {\n    lastName: null\n  }\n});\n```","url":"","summary":"","reference":"","dot":""}]},{"title":"Read","fold":false,"list":[{"prefix":"$Model","tag":".findAll","suffix":"(opt)","desc":"无参数代表整张表","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-querying-basics.md","dot":""},{"prefix":"$Model","tag":".findByPk","suffix":"(id)","desc":"使用提供的主键从表中仅获得一个条目\n`const project = await Project.findByPk(123)`","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".findOrCreate","suffix":"(opt)","desc":"除非找到一个满足查询参数的结果否则创建\n```\nconst [user, created] = await User.findOrCreate({\n  where: { username: 'sdepold' },\n  defaults: {\n    job: 'Technical Lead JavaScript'\n  }\n});\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".findOne","suffix":"(opt)","desc":"找到的第一个条目\n`const project = await Project.findOne({ where: { title: 'My Title' } })`","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".findAndCountAll","suffix":"(opt)","desc":"findAndCountAll 方法返回一个具有两个属性的对象：\ncount - 一个整数 - 符合查询条件的记录总数\nrows - 一个数组对象 - 获得的记录\n```\nconst { count, rows } = await Project.findAndCountAll({\n  where: {\n    title: {\n      [Op.like]: 'foo%'\n    }\n  },\n  offset: 10,\n  limit: 2\n});\n```","url":"","summary":"findAndCountAll 方法是结合了 findAll 和 count 的便捷方法. 在处理与分页有关的查询时非常有用,在分页中,你想检索带有 limit 和 offset 的数据,但又需要知道与查询匹配的记录总数.\n\n","reference":"","dot":""}]},{"title":"Condition(opt)","fold":false,"list":[{"prefix":"SELECT ","tag":"attributes","suffix":"[key,..]","desc":"指定列 或 SELECT *\n指定列 `attributes: ['foo', 'bar']`\n排除列 `attributes: { exclude: ['baz'] }`","url":"","summary":"","reference":"","dot":""},{"prefix":"WHERE ","tag":"where","suffix":"{key:val}","desc":"列匹配过滤 SELECT * FROM table WHERE x=val\n# AND\n```\nwhere: {\n    key1: val1,\n    key2: [1,2,3], //隐式调用IN\n    key3 : {\n        [Op.eq] : 3\n    }\n}\n```\n\n# OR\n```\nwhere: {\n    [Op.or]: [\n      { authorId: 12 },\n      { authorId: 13 }\n    ]\n}\n```","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-querying-basics.md","dot":""},{"prefix":"ORDER BY ","tag":"order","suffix":"[[key,fn]..]","desc":"排序,默认ASC升序（升序时可不用2维数组指定），可用值：NULLS FIRST\n```\nSubtask.findAll({\n  order: [\n    // 将转义 title 并针对有效方向列表进行降序排列\n    ['title', 'DESC'],\n\n    // 将按最大年龄进行降序排序\n    [sequelize.fn('max', sequelize.col('age')), 'DESC'],\n  ]\n})\n\n```","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/model-querying-basics.md","dot":""},{"prefix":"","tag":"limit","suffix":"","desc":"限制（分页）\n```\n// 提取10个实例/行\nProject.findAll({ limit: 10 });\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"","tag":"offset","suffix":"","desc":"```\n// 跳过8个实例/行\nProject.findAll({ offset: 8 });\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"","tag":"Op","suffix":"","desc":"# 逻辑运算\n`[Op.and]` AND且\n`[Op.or]` OR或\n# 相等运算\n`[Op.eq]`: 3,                              // = 3\n`[Op.ne]`: 20,                             // != 20\n`[Op.is]`: null,                           // IS NULL\n`[Op.not]`: true,                          // IS NOT TRUE\n`[Op.or]`: [5, 6],                         // (someAttribute = 5) OR (someAttribute = 6)\n# 数字比较\n`[Op.gt]`: 6,                              // > 6\n`[Op.gte]`: 6,                             // >= 6\n`[Op.lt]`: 10,                             // < 10\n`[Op.lte]`: 10,                            // <= 10\n`[Op.between]`: [6, 10],                   // BETWEEN 6 AND 10\n`[Op.notBetween]`: [11, 15],               // NOT BETWEEN 11 AND 15\n# 可选匹配\n`[Op.in]`: [1, 2],                         // IN [1, 2]\n`[Op.notIn]`: [1, 2],                      // NOT IN [1, 2]\n`[Op.startsWith]`: 'hat',                  // LIKE 'hat%' 开头\n`[Op.endsWith]`: 'hat',                    // LIKE '%hat' 结尾\n`[Op.substring]`: 'hat',                   // LIKE '%hat%' 包含\n`[Op.regexp]`: '^[h|a|t]',                 // REGEXP/~ '^[h|a|t]' (仅 MySQL/PG)\n`[Op.notRegexp]`: '^[h|a|t]',              // NOT REGEXP/!~ '^[h|a|t]' (仅 MySQL/PG)","url":"","summary":"","reference":"参考资料|https://blog.csdn.net/longshenlmj/article/details/19079221","dot":""}]},{"title":"Misc","fold":false,"list":[{"prefix":"$Model","tag":".count","suffix":"(opt)","desc":"计算数据库中元素出现的次数\n```\nconst amount = await Project.count({\n  where: {\n    id: {\n      [Op.gt]: 25\n    }\n  }\n});\nconsole.log(`这有 ${amount} 个项目 id 大于 25`);\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"$Model","tag":".max|min|sum","suffix":"(opt)","desc":"```\nawait User.max('age'); // 40\nawait User.max('age', { where: { age: { [Op.lt]: 20 } } }); // 10\nawait User.min('age'); // 5\nawait User.min('age', { where: { age: { [Op.gt]: 5 } } }); // 10\nawait User.sum('age'); // 55\nawait User.sum('age', { where: { age: { [Op.gt]: 5 } } }); // 50\n```","url":"","summary":"","reference":"","dot":""},{"prefix":"sequelize","tag":".query","suffix":"(str)","desc":"原始查询，返回两个参数 - 一个结果数组,以及一个包含元数据\n`const [results, metadata] = await sequelize.query(\"UPDATE users SET y = 42 WHERE x = 12\");`\n","url":"","summary":"","reference":"参考资料|https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/raw-queries.md","dot":""}]}]}]},{"column":[]}]}